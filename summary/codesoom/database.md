# Git의 데이터베이스

> Git의 데이터베이스는 어떻게 데이터를 관리하는지

> commit과 reset의 명령어의 작동원리

## Git의 데이터베이스의 구조

> Commit을 하면 어떤 식으로 데이터베이스에 저장되는걸까?

1. Git의 데이터베이스

- 고유값인 key와 이에 해당하는 value를 저장하는 비관계형 데이터베이스
- key : value를 해싱한 값

  - 해시(Hash)란? (해시 알고리즘)

    특정 입력값을 해시함수에 통해서 항상 일정한 길이의 값을 반환하는 알고리즘으로 이렇게 해서 나온 값을 해시값이라고 말한다. 입력값이 같으면 해시값은 항상 같은 값을 갖게 된다. 그래서 git에서는 이 해시값을 비교하여 값이 같은지 여부를 통해서 내용의 변화를 빠르게 파악할 수 있다.

- Git의 데이터베이스의 특징
  - 일반적인 데이터베이스 : CRUD 기능이 모두 가능
  - git의 데이터베이스 : CR만 가능 (UD는 불가능)
    → 고의로 git의 데이터베이스를 삭제하지 않는 이상, git에 저장된 내용은 변경되거나 삭제될 수 없다. 그래서 git의 commit 해시값만을 알고 있다면, 해당 commit에 접근해서 사용할 수 있다.

2. commit이 이루어지는 과정

- commit의 재료

  - (프로젝트 스냅샷에 대한) 최상위의 트리의 해시값
    → 프로젝트 루트에 대한 해시값
  - 부모 commit의 해시값(최초 커밋인 경우는 null)
  - 메타데이터
    → author, email, date, message 등등

- git의 데이터베이스에는 어떤 데이터들이 어떤 식으로 저장되고 결과적으로 commit은 무엇을 말하는지를 알아보자.

![git의 database](/screenshots/database.png)

- key로서 사용되는 해시값은 내용을 해싱해서 나온 값으로 고유값이다. 단, 내용이 같으면 같은 값을 갖는다. 그래서 파일을 5개지만 실제로 해싱되어서 저장된 blob은 4개가 된다. (a.txt와 c.txt는 같은 내용을 가진 파일)

- 우리가 일반적으로 말하는 commit의 해시값은 tree구조를 통해서 만들어진 가장 최종적인 해시값을 말한다. 이미지에서 보이듯이 실선핑크박스 → 실선녹색박스 → 점선빨간박스 순으로 해시값이 연결되어진다.

3. reset은 무엇일까?

- 보통 commit을 취소하는 방법 혹은 commit을 되돌리는 방법에 대해서 검색을 하면 `git reset xx` 하는 명령어를 만나게 된다. 이번에 reset의 과정을 이해하면서 알게된 부분은 reset은 취소하거나 되돌리는게 아니라 **해당 commit으로 복원하는 명령어**라는 것이다.(reset이라는 뜻과 어울리게)
